"use strict";var pager_templates_constants_1=require("./pager-templates-constants"),Pager=function(){function t(t,e,a){this.noopLogger={debug:this.noop,error:this.noop,exception:this.noop,info:this.noop,log:this.noop,trace:this.noop,warn:this.noop},this.logger=a||this.noopLogger,this.logger.debug("constructor"),this.options=this.createOptions(t),this.currentPage=this.options.firstPage,this.updatePagerState(this.options),this.parentElement=e||document.body;var i=this.buildPager(this.options);this.parentElement.appendChild(i)}return t.prototype.pageTo=function(t){this.logger.debug("pageTo("+t+")"),t>0&&t<=this.totalNumberOfPages&&(this.displayPageInput=this.convertFromDecimal(t),this.currentPage=this.displayPageInput,this.updatePager())},t.prototype.updatePager=function(){this.updatePagerState(this.options);var t=this.buildPager(this.options),e=document.getElementById("pager-container-"+this.id);e?e.parentElement.replaceChild(t,e):this.parentElement.appendChild(t),this.parentElement.dispatchEvent(new CustomEvent("page",{detail:{id:this.id}}))},t.prototype.updateCurrentPage=function(){this.logger.debug("updateCurrentPage");var t=this.pageInputIsValid(),e=document.getElementById("page-input-"+this.id);t?(this.pageTo(this.convertToDecimal.call(this,this.displayPageInput)),e.classList.contains("invalid")&&e.classList.remove("invalid")):e.classList.contains("invalid")||e.classList.add("invalid")},t.prototype.pageInputIsValid=function(){this.logger.debug("pageInputIsValid");var t=this.convertToDecimal(this.displayPageInput);return!!t&&!isNaN(t)&&t>=1&&t<=this.totalNumberOfPages},Object.defineProperty(t.prototype,"displayPageInput",{get:function(){return parseInt(this.input.value,10)},set:function(t){this.input&&(this.input.value=t.toString())},enumerable:!0,configurable:!0}),t.prototype.createOptions=function(t){return this.logger.debug("createOptions"),t=t||{},t.firstPage=t.firstPage||1,t.convertFromDecimal=t.convertFromDecimal||this.convertFromDecimal.bind(this),t.convertToDecimal=t.convertToDecimal||this.convertToDecimal.bind(this),t.totalNumberOfRecords=t.totalNumberOfRecords||0,t.enableFirstLastPageArrows=t.enableFirstLastPageArrows||!1,t.enablePageArrows=t.enablePageArrows||!1,t.enablePageInput=t.enablePageInput||!1,t.maximumNumberOfExplicitPagesToDisplay=Math.max(t.maximumNumberOfExplicitPagesToDisplay||7,5),t.pageSize=t.pageSize||10,t.id=t.id||Math.floor(1e4*Math.random()).toString(),t},t.prototype.createTemplates=function(t){return this.logger.debug("createTemplates"),t=t||{},t.pageToBeginningHtml=t.pageToBeginningHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_TO_BEGINNING_HTML,t.pageRetreatHtml=t.pageRangeHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_RETREAT_HTML,t.pageToFirstHtml=t.pageToFirstHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_TO_FIRST_HTML,t.pageFillerBeforeHtml=t.pageFillerBeforeHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_FILLER_BEFORE_HTML,t.pageRangeHtml=t.pageRangeHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_RANGE_HTML,t.pageFillerAfterHtml=t.pageFillerAfterHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_FILLER_AFTER_HTML,t.pageToLastHtml=t.pageToLastHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_TO_LAST_HTML,t.pageAdvanceHtml=t.pageAdvanceHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_ADVANCE_HTML,t.pageToEndHtml=t.pageToEndHtml||pager_templates_constants_1.PagerTemplateConstants.DEFAULT_PAGE_TO_END_HTML,t},t.prototype.convertFromDecimal=function(t){return this.logger.debug("convertFromDecimal("+t+")"),t},t.prototype.convertToDecimal=function(t){return this.logger.debug("convertToDecimal("+t+")"),parseInt(t,10)},t.prototype.noop=function(){},t.prototype.updatePagerState=function(t){this.logger.debug("updatePagerState"),this.totalNumberOfPages=t.pageSize&&t.totalNumberOfRecords?t.totalNumberOfRecords/t.pageSize:0,this.id=t.id,this.convertFromDecimal=t.convertFromDecimal.bind(this),this.convertToDecimal=t.convertToDecimal.bind(this),this.maximumNumberOfExplicitPagesToDisplay=t.maximumNumberOfExplicitPagesToDisplay,this.canPageBackward=this.currentPage>t.firstPage,this.canPageForward=this.currentPage<this.totalNumberOfPages,this.hasMorePagesBackward=!1,this.hasMorePagesForward=!1,this.currentPage>t.firstPage+2&&this.totalNumberOfPages>this.maximumNumberOfExplicitPagesToDisplay&&(this.hasMorePagesBackward=!0),this.currentPage<this.totalNumberOfPages-2&&this.totalNumberOfPages>this.maximumNumberOfExplicitPagesToDisplay&&(this.hasMorePagesForward=!0);var e,a;if(this.hasMorePagesBackward||this.hasMorePagesForward)if(this.hasMorePagesBackward)if(this.hasMorePagesForward){var i=this.maximumNumberOfExplicitPagesToDisplay%2===1,s=Math.ceil((this.maximumNumberOfExplicitPagesToDisplay-5)/2);this.currentPage+s===this.totalNumberOfPages-2?(this.hasMorePagesForward=!1,e=this.currentPage-s,a=this.totalNumberOfPages):i?(e=this.currentPage-s,a=this.currentPage+s+1):(e=this.currentPage-s+1,a=this.currentPage+s+1)}else a=this.totalNumberOfPages,e=this.totalNumberOfPages-this.maximumNumberOfExplicitPagesToDisplay+3;else e=t.firstPage+1,a=this.maximumNumberOfExplicitPagesToDisplay-1;else e=t.firstPage+1,a=this.totalNumberOfPages;for(this.pagesRange=[];e<a;e++)this.pagesRange.push({displayPage:t.convertFromDecimal(e),page:e})},t.prototype.buildPager=function(t){var e=this,a=this.createTemplates(t.templates),i=[],s=[],r=this.totalNumberOfPages>t.firstPage,n=t.convertFromDecimal(t.firstPage),o=t.convertFromDecimal(this.totalNumberOfPages);if(t.enableFirstLastPageArrows&&(i.push(this.buildButton(a.pageToBeginningHtml,"arrow-page-to-beginning",!this.canPageBackward,this.pageTo.bind(this,t.firstPage))),s.unshift(this.buildButton(a.pageToEndHtml,"arrow-page-to-end",!this.canPageForward,this.pageTo.bind(this,this.totalNumberOfPages)))),t.enablePageArrows&&(i.push(this.buildButton(a.pageRetreatHtml,"arrow-page-retreat",!this.canPageBackward,this.pageTo.bind(this,this.currentPage-1))),s.unshift(this.buildButton(a.pageAdvanceHtml,"arrow-page-advance",!this.canPageForward,this.pageTo.bind(this,this.currentPage+1)))),r){var g=a.pageToFirstHtml.replace(pager_templates_constants_1.PagerTemplateConstants.PAGE_TO_FIRST_PLACEHOLDER,n.toString());i.push(this.buildButton(g,"page-to-beginning",!this.canPageBackward,this.pageTo.bind(this,t.firstPage))),g=a.pageToLastHtml.replace(pager_templates_constants_1.PagerTemplateConstants.PAGE_TO_LAST_PLACEHOLDER,o.toString()),s.unshift(this.buildButton(g,"arrow-page-end",!this.canPageForward,this.pageTo.bind(this,this.totalNumberOfPages)))}if(this.hasMorePagesBackward&&i.push(this.buildButton(a.pageFillerBeforeHtml,"page-filler-before")),this.hasMorePagesForward&&s.unshift(this.buildButton(a.pageFillerAfterHtml,"page-filler-after")),this.pagesRange.forEach(function(t){var s=a.pageRangeHtml.replace(pager_templates_constants_1.PagerTemplateConstants.PAGE_RANGE_PLACEHOLDER,t.displayPage);i.push(e.buildButton(s,"page-"+t.page,e.currentPage===t.page,e.pageTo.bind(e,t.page)))}),t.enablePageInput){var p=document.createElement("input");p.id="page-input-"+this.id,p.value=this.currentPage.toString(),p.addEventListener("blur",this.updateCurrentPage.bind(this),!1),this.input=p,s.push(p)}var l=document.createElement("div");return l.id="pager-container-"+this.id,i.concat(s).forEach(function(t){l.appendChild(t)}),l},t.prototype.buildButton=function(t,e,a,i){void 0===a&&(a=!0),void 0===i&&(i=null);var s=document.createElement("button");return s.id=e,a&&(s.disabled=!0),i&&s.addEventListener("click",i,!1),s.innerHTML=t,s},t}();exports.Pager=Pager;